////
This file is only meant to be included as a snippet in other documents.
There is a version of this file for the general 'Installing Jenkins' page
(index.adoc) and another for tutorials (_run-jenkins-in-docker.adoc).
This file is for the index.adoc page used in the general 'Installing Jenkins'
page.
If you update content on this page, please ensure the changes are reflected in
the sibling file _docker-for-tutorials.adoc (used in
_run-jenkins-in-docker.adoc).
////

[[using-the-wizard-with-docker-compose]]
== Using the wizard.

The first method we proposed (<<quickstart-tutorials-repository>>) is the easiest way to get Jenkins up and running.
However, you may want to have a better feel of what's happening under the hood. +
This is where the second method comes in. +
You can still use the same link:https://github.com/jenkins-docs/quickstart-tutorials.git[quickstart-tutorials repository] as in the first step. +
If you have already launched the Jenkins instance previously, you can stop it by running the command `docker compose down -v --remove-orphans`. +
Once it's done, you can proceed with the second method.

[source,bash]
----
docker compose --profile wizard up
----
This time, we're not using the `default` profile, but the `wizard` profile.
This profile will guide you through the setup of Jenkins.
We're not using the `-d` or `--detach` option, so you can see the output of the containers, and get a better understanding of what's happening.
After a while, you should see something like this displaying in the console:
[source,bash]
----
wizard_controller-1      | *************************************************************
wizard_controller-1      | *************************************************************
wizard_controller-1      | *************************************************************
wizard_controller-1      |
wizard_controller-1      | Jenkins initial setup is required. An admin user has been created and a password generated.
wizard_controller-1      | Please use the following password to proceed to installation:
wizard_controller-1      |
wizard_controller-1      | 1725812a80294239bd0859973c0965a1
wizard_controller-1      |
wizard_controller-1      | This may also be found at: /var/jenkins_home/secrets/initialAdminPassword
wizard_controller-1      |
wizard_controller-1      | *************************************************************
wizard_controller-1      | *************************************************************
wizard_controller-1      | *************************************************************
wizard_controller-1      |
----

Copy the generated password, and access the Jenkins controller at http://localhost:8080 .

[.boxshadow]
image:tutorials/docker/unlock-jenkins.png[alt="Copying initial admin password",width=860] +
Paste the password in the *Administrator password* field, and click on the *Continue* button.

[.boxshadow]
image:tutorials/docker/choose-plugins-installation.png[alt="Choosing plugins",width=860] +
Two options are available: *Install suggested plugins* and *Select plugins to install*. +
We'll choose the *Install suggested plugins* option for this tutorial, but you could choose the other option if you already know which plugins you will need.

[.boxshadow]
image:tutorials/docker/plugins-installation.png[alt="Plugins installing",width=860] +
The default set of plugins will then be installed. +
This process may take a few minutes.
You will then be presented with the *Create First Admin User* page.

[.boxshadow]
image:tutorials/docker/create-first-admin-user.png[alt="Creating first admin user",width=860] +
You can create the first admin user by filling in the required fields.
Once you've filled in the fields, click on the *Save and Continue* button.
You will then be redirected to the *Instance Configuration* page.

[.boxshadow]
image:tutorials/docker/instance-configuration.png[alt="Instance configuration",width=860] +
That's the place where you'll configure the Jenkins controller's URL.
By default, it is set to `http://localhost:8080`. +
You can keep it as is.
Click on the *Save and Finish* button.

Depending on the set of plugins installed, you may be redirected to the Jenkins dashboard or to this page, stating that Jenkins has to be restarted.
[.boxshadow]
image:tutorials/docker/jenkins-is-almost-ready.png[alt="Restart Jenkins",width=860] +

[[connecting-an-agent-with-docker-compose]]
== Connecting an agent

Now that you have your Jenkins controller up and running, you can connect an agent to it.
In this tutorial, we'll use an link:/doc/pipeline/steps/ssh-agent/#ssh-agent-plugin[SSH agent] that will be running in a Docker container.
To do so, you need to create a new agent in Jenkins and configure it to connect to the agent container.
But first of all, we need to install the link:https://github.com/jenkinsci/ssh-agent-plugin[SSH agent plugin] and create the credentials.

=== Installing the SSH agent plugin

Once connected to the dashboard:

. Click on *Manage Jenkins* in the left-hand menu.
. Then, click on *Plugins*.
. Click on the *Available Plugins* menu, and then in the search box enter `SSH agent`.

[.boxshadow]
image:tutorials/docker/install-ssh-agent-plugin.png[alt="Installing the SSH agent plugin",width=860] +
Click in the checkbox under *"Install* and click on the *Install* blue button on the right.

[.boxshadow]
image:tutorials/docker/installing-ssh-agent-plugin.png[alt="Installing the SSH agent plugin",width=860] +
You can then click on the checkbox on the left of *Restart Jenkins when installation is complete and no jobs are running* on the very bottom of the page.
Jenkins will then restart, but that should be fast.
You can then log back in.

=== Creating the credentials

Once the plugin is installed, you can create the credentials.

. Click on *Manage Jenkins* in the left-hand menu.
. Then, click on *Credentials*.
. Click on *System*.
. Click on *Global credentials (unrestricted)*.
. Click on *Add Credentials* (blue button on the right).
[.boxshadow]
image:tutorials/docker/add-credentials.png[alt="Adding credentials",width=860] +
. In the *Kind* listbox, choose *SSH Username with private key*.
. In the *Scope* listbox, choose *Global (Jenkins, nodes, items, all child items, etc)*.
. Fill in the *ID* field with `jenkins_agent_ssh_key`.
. Fill in the *Description* field with `Jenkins agent SSH key`.
. Fill in the *Username* field with `jenkins`.
. In the *Private Key* field, click on the *Enter directly* radio button.
. Click on *Add*.
. In the *Key* field, paste the content of the `jenkins_agent_ed` file you can find in the `wizard_agent` thanks to the following command: `docker compose exec wizard_agent cat /home/jenkins/.ssh/jenkins_agent_ed`
. Copy the content beginning with `-----BEGIN OPENSSH PRIVATE KEY-----` and ending with `-----END OPENSSH PRIVATE KEY-----` and paste it in the *Key* field.
[.boxshadow]
image:tutorials/docker/ssh-credentials.png[alt="SSH credentials",width=860] +
. Click on *Create*.

=== Creating the agent

Now that the credentials are created, you can create the agent.

. Navigate to the Jenkins dashboard and click on *Manage Jenkins* in the left-hand menu.
. Then, click on *Nodes*.
. Click on *New Node* on the top right.
. Fill in the *Node name* field with `wizard_agent`.
. Choose *Permanent Agent*.
. Click on *Create*.
. Fill in the *Description* field with `Jenkins agent`.
. Fill in the *Remote root directory* field with `/home/jenkins`.
. In the *Launch method* listbox, choose *Launch agent via SSH*.
. Fill in the *Host* field with `wizard_agent`.
. Fill in the *Credentials* field with `jenkins (Jenkins agent SSH key)` (that's the key we created a few minutes ago).
. Fill in the *Host Key Verification Strategy* listbox with `Non verifying Verification Strategy`.
. Click on *Save*.

[.boxshadow]
image:tutorials/docker/create-agent.png[alt="Creating agent",width=860] +

You can now see the agent in the list of nodes.
There is still a red warning in the top part, just next to the search box linked to the agents.
When you hover over it, you can see this message:
[.boxshadow]
image:tutorials/docker/agent-warning.png[alt="Agent warning",width=860] +

> Building on the built-in node can be a security issue. You should set the number of executors on the built-in node to 0. See link:/redirect/building-on-controller/[the documentation]

Let's address this issue.

=== Disabling the built-in node


[[accessing-the-jenkins-docker-containers]]
== Accessing the Docker containers

If you'd like to access the Docker container running your Jenkins controller through a terminal or command prompt using the link:https://docs.docker.com/reference/cli/docker/compose/exec/[`docker compose exec`] command, include the name of the service within the command to get something like:

[source,bash]
----
$ docker compose exec jenkins_controller bash
jenkins@be6994815148:/$ # We are now in the container running Jenkins
----

This will access the Docker container named "jenkins_controller."
As with standard access to a machine, you can exit the container by typing `exit` or pressing +++<kbd>Ctrl+D</kbd>+++.

To access the Docker container running your Jenkins agent, use the following command:

[source,bash]
----
$ docker compose exec default_agent bash
jenkins@be6994815148:/$ # We are now in the container running the Jenkins agent
----

To leave the container, type `exit` or press +++<kbd>Ctrl+D</kbd>+++.

[[accessing-the-jenkins-console-log-through-docker-logs]]
== Accessing the Docker logs

Should you need to access the services logs, you can do so by running the following command:
[source,bash]
----
docker compose logs -f
----

This command will display the logs of all services running in the dockerized Jenkins instance.
You will see the logs of the Jenkins controller, Jenkins agent, and the side-kick service.
If you would like to see the logs of a specific service, you can do so by specifying the service name as follows:
[source,bash]
----
docker compose logs -f <service-name>
----

With `<service-name>` being:

- `jenkins_controller` for the Jenkins controller
- `default_agent` for the Jenkins agent

== Accessing the Jenkins home directory

You can access the Jenkins home directory, to check the details of a Jenkins build in the `jobs` subdirectory, for example.
To access the Jenkins home directory, use the following command:
[source,bash]
----
docker compose exec jenkins_controller bash
----

You will then be in the Jenkins controller container.
To access the Jenkins home directory, use the following command:
[source,bash]
----
jenkins@be6994815148:/$ cd /var/jenkins_home/jobs
jenkins@be6994815148:/var/jenkins_home/jobs$ ls -la
----

This will list all the jobs in the Jenkins home directory.

Should you want to copy the jobs subdirectory from the Jenkins home directory to your local machine, you can use the following command:
[source,bash]
----
docker compose cp jenkins_controller:/var/jenkins_home/jobs <local-path>
----

With `<local-path>` being the path on your local machine where you want to copy the jobs subdirectory.

